<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHH-ELF.EXE :: Reading Revolution Terminal</title>
    <meta name="description" content="A Book Talk Tool to Spark Reading Through Curiosity and Connection">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-green: #00ff00;
            --dark-green: #008000;
            --bg-black: #000000;
            --bg-dark: #111111;
            --white: #ffffff;
            --gray: #333333;
            --light-gray: #666666;
            --pixel-size: 2px;
        }
        
        body {
            font-family: 'VT323', 'Courier New', monospace;
            background: var(--bg-black);
            color: var(--primary-green);
            line-height: 1.4;
            font-size: 18px;
            overflow-x: hidden;
            cursor: crosshair;
        }
        
        /* Scanlines Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 255, 0, 0.03) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
        }
        
        /* CRT Flicker */
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            98% { opacity: 0.98; }
            99% { opacity: 1; }
        }
        
        body {
            animation: flicker 3s infinite;
        }
        
        /* Header Terminal */
        .terminal-header {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--bg-black);
            border-bottom: 2px solid var(--primary-green);
            padding: 8px 16px;
            z-index: 100;
            font-size: 14px;
        }
        
        .terminal-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .terminal-title {
            color: var(--primary-green);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .terminal-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .user-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-right: 20px;
        }

        .user-btn {
            background: transparent;
            color: var(--primary-green);
            border: 1px solid var(--primary-green);
            padding: 4px 8px;
            font-family: 'VT323', monospace;
            font-size: 12px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-btn:hover {
            background: var(--primary-green);
            color: var(--bg-black);
        }

        .username-display {
            color: var(--primary-green);
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .control-btn {
            width: 12px;
            height: 12px;
            border: 1px solid var(--primary-green);
            background: transparent;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .control-btn:hover {
            background: var(--primary-green);
        }
        
        /* Main Content */
        .main-content {
            margin-top: 40px;
            padding: 20px;
        }
        
        
        /* Command Prompt Style */
        .cmd-line {
            color: var(--primary-green);
            margin: 10px 0;
            font-family: 'VT323', monospace;
        }
        
        .cmd-prompt {
            color: var(--dark-green);
        }
        
        /* Hero Section */
        .hero {
            padding: 40px 20px;
            text-align: center;
            border: 2px solid var(--primary-green);
            margin: 20px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 0, 0.05) 2px,
                rgba(0, 255, 0, 0.05) 4px
            );
        }
        
        .hero h1 {
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px var(--dark-green);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 5px var(--primary-green); }
            to { text-shadow: 0 0 20px var(--primary-green), 0 0 30px var(--primary-green); }
        }
        
        .tagline {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--white);
            animation: typewriter 3s steps(40);
            overflow: hidden;
            white-space: nowrap;
            border-right: 2px solid var(--primary-green);
        }
        
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .hero-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            color: var(--white);
        }
        
        /* Pixel Button */
        .pixel-btn {
            background: var(--bg-black);
            color: var(--primary-green);
            border: 3px solid var(--primary-green);
            padding: 12px 24px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            position: relative;
            box-shadow: 4px 4px 0px var(--dark-green);
        }
        
        .pixel-btn:hover {
            background: var(--primary-green);
            color: var(--bg-black);
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--dark-green);
        }
        
        .pixel-btn:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }
        
        /* Terminal Quote */
        .terminal-quote {
            margin: 40px 20px;
            padding: 20px;
            border: 2px solid var(--light-gray);
            background: var(--bg-dark);
            font-style: italic;
            text-align: center;
            position: relative;
        }
        
        .terminal-quote::before {
            content: "QUOTE.TXT";
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-black);
            color: var(--light-gray);
            padding: 0 8px;
            font-size: 12px;
        }
        
        /* Features Grid */
        .features-section {
            padding: 40px 20px;
        }
        
        .section-header {
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 40px;
            color: var(--white);
            border-bottom: 2px solid var(--primary-green);
            padding-bottom: 10px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .feature-window {
            border: 2px solid var(--primary-green);
            background: var(--bg-dark);
            padding: 20px;
            position: relative;
        }
        
        .window-header {
            background: var(--primary-green);
            color: var(--bg-black);
            padding: 8px;
            margin: -20px -20px 20px -20px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .feature-content {
            color: var(--white);
            line-height: 1.6;
        }
        
        /* Playground Section */
        .playground {
            margin: 40px 20px;
            border: 3px solid var(--primary-green);
            background: var(--bg-dark);
            padding: 30px;
        }
        
        .playground-header {
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--primary-green);
        }
        
        .playground-desc {
            text-align: center;
            color: var(--white);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        /* Form Styling */
        .terminal-form {
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg-black);
            border: 2px solid var(--primary-green);
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: var(--primary-green);
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 1px;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            background: var(--bg-black);
            border: 2px solid var(--light-gray);
            color: var(--white);
            padding: 12px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--light-gray);
        }
        
        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            border: 2px solid var(--primary-green);
            background: var(--bg-dark);
            margin: 20px 0;
        }
        
        .loading-text {
            color: var(--primary-green);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* Email validation message */
        .email-validation-message {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            text-transform: uppercase;
        }

        .email-validation-message.error {
            color: #ff6b6b;
            border-left: 2px solid #ff6b6b;
            padding-left: 8px;
        }

        .email-validation-message.success {
            color: var(--primary-green);
            border-left: 2px solid var(--primary-green);
            padding-left: 8px;
        }

        .email-validation-message.checking {
            color: var(--light-gray);
            border-left: 2px solid var(--light-gray);
            padding-left: 8px;
        }
        
        .loading-bar {
            width: 100%;
            height: 20px;
            border: 2px solid var(--primary-green);
            background: var(--bg-black);
            position: relative;
            overflow: hidden;
        }
        
        .loading-fill {
            height: 100%;
            background: var(--primary-green);
            width: 0%;
            animation: loading-progress 3s ease-in-out infinite;
        }
        
        @keyframes loading-progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        /* Result Section */
        .result {
            display: none;
            margin-top: 30px;
            border: 2px solid var(--primary-green);
            background: var(--bg-dark);
            padding: 20px;
        }
        
        .result-header {
            color: var(--primary-green);
            font-size: 1.5rem;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .audio-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .audio-player {
            width: 100%;
            background: var(--bg-black);
            border: 2px solid var(--primary-green);
        }
        
        .share-container {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid var(--light-gray);
            background: var(--bg-black);
        }
        
        .share-url {
            width: 100%;
            background: var(--bg-dark);
            color: var(--white);
            border: 1px solid var(--light-gray);
            padding: 10px;
            font-family: 'VT323', monospace;
            margin-bottom: 10px;
        }
        
        /* Language Switcher */
        .lang-switch {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-black);
            border: 2px solid var(--primary-green);
            color: var(--primary-green);
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'VT323', monospace;
            text-transform: uppercase;
            transition: all 0.3s;
            z-index: 100;
        }
        
        .lang-switch:hover {
            background: var(--primary-green);
            color: var(--bg-black);
        }
        
        /* Error Message */
        .error-msg {
            display: none;
            background: var(--bg-black);
            border: 2px solid #ff0000;
            color: #ff0000;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
                letter-spacing: 2px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 10px;
            }
        }
        
        /* Matrix Rain Effect (Optional) */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        /* Modal styles for login/register */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-dark);
            border: 3px solid var(--primary-green);
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-header {
            font-size: 1.5rem;
            text-transform: uppercase;
            color: var(--primary-green);
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: var(--primary-green);
            font-size: 20px;
            cursor: pointer;
        }

        .history-container {
            display: none;
            margin: 40px 20px;
            border: 3px solid var(--primary-green);
            background: var(--bg-dark);
            padding: 30px;
        }

        .history-header {
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--primary-green);
        }

        .history-item {
            border: 2px solid var(--light-gray);
            background: var(--bg-black);
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-book-title {
            color: var(--primary-green);
            font-size: 1.2rem;
            text-transform: uppercase;
        }

        .history-date {
            color: var(--light-gray);
            font-size: 0.9rem;
        }

        .history-details {
            color: var(--white);
            margin-bottom: 10px;
        }

        .history-audio {
            margin-top: 10px;
        }

        /* Book Gallery Styles */
        .book-gallery {
            margin: 40px 20px;
            border: 3px solid var(--primary-green);
            background: var(--bg-dark);
            padding: 30px;
        }

        .gallery-header {
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--primary-green);
        }

        .gallery-desc {
            text-align: center;
            color: var(--white);
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .filter-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: transparent;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
            padding: 8px 16px;
            font-family: 'VT323', monospace;
            font-size: 14px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--primary-green);
            color: var(--bg-black);
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .book-card {
            border: 2px solid var(--light-gray);
            background: var(--bg-black);
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .book-card:hover {
            border-color: var(--primary-green);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .book-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .book-cover {
            width: 80px;
            height: 120px;
            border: 1px solid var(--light-gray);
            background: var(--gray);
            flex-shrink: 0;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-info {
            flex: 1;
        }

        .book-title {
            color: var(--primary-green);
            font-size: 1.3rem;
            text-transform: uppercase;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .book-author {
            color: var(--white);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .book-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .meta-tag {
            background: var(--primary-green);
            color: var(--bg-black);
            padding: 2px 8px;
            font-size: 11px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .difficulty-tag {
            background: #ff6b6b;
            color: white;
        }

        .vocab-tag {
            background: #4ecdc4;
            color: white;
        }

        .sample-section {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid var(--light-gray);
            background: var(--bg-dark);
        }

        .sample-title {
            color: var(--primary-green);
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .sample-text {
            color: var(--white);
            line-height: 1.6;
            font-style: italic;
            margin-bottom: 10px;
        }

        .formal-models {
            margin: 10px 0;
        }

        .formal-model-tag {
            display: inline-block;
            background: var(--dark-green);
            color: var(--white);
            padding: 3px 8px;
            margin: 2px;
            font-size: 10px;
            text-transform: uppercase;
            border-radius: 2px;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .audio-btn {
            background: transparent;
            color: var(--primary-green);
            border: 1px solid var(--primary-green);
            padding: 8px 12px;
            font-family: 'VT323', monospace;
            font-size: 12px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
        }

        .audio-btn:hover {
            background: var(--primary-green);
            color: var(--bg-black);
        }

        .audio-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: 1fr;
            }

            .book-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .filter-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Terminal Header -->
    <div class="terminal-header">
        <div class="terminal-bar">
            <span class="terminal-title">SHH-ELF.EXE - READING REVOLUTION TERMINAL</span>
            <div class="terminal-controls">
                <div class="user-controls" id="userControls">
                    <div id="loggedOutControls">
                        <button class="user-btn" onclick="showModal('loginModal')">LOGIN</button>
                        <button class="user-btn" onclick="showModal('registerModal')">REGISTER</button>
                    </div>
                    <div id="loggedInControls" style="display: none;">
                        <span class="username-display" id="usernameDisplay">USER: LOADING...</span>
                        <button class="user-btn" onclick="showHistory()">HISTORY</button>
                        <button class="user-btn" onclick="logout()">LOGOUT</button>
                    </div>
                </div>
                <div class="control-btn"></div>
                <div class="control-btn"></div>
                <div class="control-btn"></div>
            </div>
        </div>
    </div>

    <!-- Matrix Background -->
    <canvas class="matrix-bg" id="matrix"></canvas>

    <!-- Main Content -->
    <div class="main-content">

        <!-- Command Line Style Intro -->
        <div class="cmd-line">
            <span class="cmd-prompt">C:\READING\REVOLUTION></span> INITIALIZING_BOOK_DISCOVERY_PROTOCOL...
        </div>
        <div class="cmd-line">
            <span class="cmd-prompt">C:\READING\REVOLUTION></span> LOADING_CURIOSITY_ENGINE...
        </div>
        <div class="cmd-line">
            <span class="cmd-prompt">C:\READING\REVOLUTION></span> STATUS: READY_FOR_STORY_TRANSMISSION
        </div>

        <!-- Hero Section -->
        <section class="hero">
            <h1>SHH-ELF</h1>
            <div class="tagline">SHH... A STORY'S ABOUT TO BEGIN.</div>
            <div class="hero-description">
                TRANSFORM READING INTO A CURIOUS, SOCIAL, AND EMOTIONALLY ENGAGING 
                EXPERIENCE THROUGH BITE-SIZED BOOK TALKS AND PERSONALIZED RECOMMENDATIONS.
            </div>
            <a href="gallery.html" class="pixel-btn" style="margin-right: 15px;">EXPLORE BOOK GALLERY</a>
            <a href="playground.html" class="pixel-btn">INITIATE READING SEQUENCE</a>
        </section>

        <!-- Terminal Quote -->
        <div class="terminal-quote">
            "FINDING BOOKS IS HARD... IT TAKES ME A LONG TIME TO FINISH THE FIRST CHAPTER AND 
            I'M NOT EVEN SURE IF I LIKE IT."<br>
            <strong>‚Äî TEEN INTERVIEWEE DATABASE ENTRY #001</strong>
        </div>

        <!-- Features Section -->
        <section class="features-section">
            <h2 class="section-header">SYSTEM MODULES</h2>
            
            <div class="features-grid">
                <div class="feature-window">
                    <div class="window-header">BOOK_TALK_GALLERY.EXE</div>
                    <div class="feature-content">
                        Short audio clips to spark interest. Designed for curious or reluctant readers. 
                        EMOTION-FIRST! Not summary-first. Bypassing traditional recommendation algorithms.
                    </div>
                </div>
                
                <div class="feature-window">
                    <div class="window-header">BOOK_TALK_PLAYGROUND.EXE</div>
                    <div class="feature-content">
                        Students upload a few lines about someone they want to recommend a book to. 
                        AI transforms it into a podcast-style voice memo‚Äînatural, emotional, shareable.
                    </div>
                </div>
                
                <div class="feature-window">
                    <div class="window-header">SOCIAL_DISCOVERY.EXE</div>
                    <div class="feature-content">
                        People read more when they're curious. Reading sticks when it leads to conversation. 
                        Peer recommendations matter more than generic algorithmic lists.
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Navigation to dedicated pages -->
    <div style="text-align: center; padding: 60px 20px; background: var(--bg-dark); margin: 40px 20px; border: 2px solid var(--primary-green);">
        <h2 style="color: var(--primary-green); font-size: 2rem; text-transform: uppercase; margin-bottom: 30px;">
            READY TO START YOUR READING JOURNEY?
        </h2>
        <div style="display: flex; gap: 30px; justify-content: center; flex-wrap: wrap;">
            <a href="gallery.html" class="pixel-btn" style="font-size: 1.3rem; padding: 20px 30px;">
                üìö EXPLORE GALLERY
            </a>
            <a href="playground.html" class="pixel-btn" style="font-size: 1.3rem; padding: 20px 30px;">
                üéÆ CREATE RECOMMENDATIONS
            </a>
        </div>
    </div>
            <div class="playground-header">BOOK TALK PLAYGROUND</div>
            <div class="playground-desc">
                CREATE A PERSONALIZED BOOK RECOMMENDATION FOR SOMEONE SPECIAL. 
                OUR AI WILL TURN YOUR THOUGHTS INTO A NATURAL, EMOTIONAL VOICE MEMO.
            </div>
            
            <div class="terminal-form">
                <!-- Error Message -->
                <div class="error-msg" id="errorMessage">
                    <span id="errorText">SYSTEM ERROR: PLEASE TRY AGAIN</span>
                </div>
                
                <form id="recommendationForm">
                    <div class="form-group">
                        <label for="book_title" class="form-label" id="label-book">BOOK TITLE</label>
                        <input type="text" id="book_title" name="book_title" class="form-input" required 
                               placeholder="e.g., The Seven Husbands of Evelyn Hugo">
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient_name" class="form-label" id="label-recipient">RECOMMEND TO</label>
                        <input type="text" id="recipient_name" name="recipient_name" class="form-input" required 
                               placeholder="e.g., Sarah, my book-loving friend">
                    </div>
                    
                    <div class="form-group">
                        <label for="relationship" class="form-label" id="label-relationship">RELATIONSHIP</label>
                        <select id="relationship" name="relationship" class="form-select">
                            <option value="friend">FRIEND</option>
                            <option value="classmate">CLASSMATE</option>
                            <option value="colleague">COLLEAGUE</option>
                            <option value="family">FAMILY</option>
                            <option value="student">STUDENT</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="recipient_interests" class="form-label" id="label-interests">THEIR INTERESTS (OPTIONAL)</label>
                        <textarea id="recipient_interests" name="recipient_interests" class="form-textarea" rows="3" 
                                  placeholder="e.g., loves romance novels, enjoys character-driven stories..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="language" class="form-label" id="label-language">LANGUAGE</label>
                        <select id="language" name="language" class="form-select">
                            <option value="English">ENGLISH</option>
                            <option value="‰∏≠Êñá">‰∏≠Êñá</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tone" class="form-label" id="label-tone">RECOMMENDATION TONE</label>
                        <select id="tone" name="tone" class="form-select">
                            <option value="friendly and enthusiastic">FRIENDLY & ENTHUSIASTIC</option>
                            <option value="professional and objective">PROFESSIONAL & OBJECTIVE</option>
                            <option value="casual and humorous">CASUAL & HUMOROUS</option>
                            <option value="warm and caring">WARM & CARING</option>
                        </select>
                    </div>

                    <div class="form-group" id="dialect-group" style="display: none;">
                        <label for="dialect" class="form-label" id="label-dialect">ËØ≠Èü≥ÊñπË®Ä</label>
                        <select id="dialect" name="dialect" class="form-select">
                            <option value="zh-CN-XiaoxiaoNeural" selected>ÊôÆÈÄöËØù (Â•≥Â£∞)</option>
                            <option value="zh-CN-liaoning-XiaobeiNeural">‰∏úÂåóËØù (Â•≥Â£∞)</option>
                            <option value="zh-CN-liaoning-YunbiaoNeural">‰∏úÂåóËØù (Áî∑Â£∞)</option>
                            <option value="wuu-CN-XiaotongNeural">‰∏äÊµ∑ËØù (Â•≥Â£∞)</option>
                            <option value="wuu-CN-YunzheNeural">‰∏äÊµ∑ËØù (Áî∑Â£∞)</option>
                            <option value="zh-CN-sichuan-YunxiNeural">ÂõõÂ∑ùËØù (Áî∑Â£∞)</option>
                            <option value="zh-CN-shandong-YunxiangNeural">Â±±‰∏úËØù (Áî∑Â£∞)</option>
                            <option value="zh-CN-shaanxi-XiaoniNeural">ÈôïË•øËØù (Â•≥Â£∞)</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="pixel-btn" id="submit-btn" style="width: 100%; margin-top: 20px;">
                        GENERATE AUDIO RECOMMENDATION
                    </button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="loading-text" id="loading-text1">GENERATING PERSONALIZED BOOK TALK...</div>
                    <div class="loading-bar">
                        <div class="loading-fill"></div>
                    </div>
                    <div class="loading-text" id="loading-text2">PROCESSING NEURAL NETWORKS... 10-15 SECONDS</div>
                </div>
                
                <div class="result" id="result">
                    <div class="result-header" id="success-title">BOOK TALK GENERATED SUCCESSFULLY!</div>
                    <div class="audio-container">
                        <audio controls class="audio-player" id="audioPlayer">
                            Your browser does not support audio playback.
                        </audio>
                    </div>
                    <div class="share-container">
                        <label class="form-label" id="share-title">SHARE YOUR RECOMMENDATION</label>
                        <input type="text" id="shareUrl" class="share-url" readonly placeholder="Share link will appear here">
                        <button onclick="copyToClipboard()" class="pixel-btn" id="copy-btn" style="width: 100%; margin-top: 10px;">COPY LINK</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- User History Section -->
        <section id="history" class="history-container">
            <div class="history-header">MY RECOMMENDATION HISTORY</div>
            <div id="historyContent">
                <div class="loading-text">Loading your recommendations...</div>
            </div>
        </section>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="hideModal('loginModal')">&times;</button>
            <div class="modal-header">LOGIN</div>
            <form id="loginForm">
                <div class="form-group">
                    <input type="text" id="loginUsername" class="form-input" placeholder="USERNAME" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-input" placeholder="PASSWORD" required>
                </div>
                <button type="submit" class="pixel-btn" style="width: 100%;">LOGIN</button>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal-overlay">
        <div class="modal">
            <button class="modal-close" onclick="hideModal('registerModal')">&times;</button>
            <div class="modal-header">REGISTER</div>
            <form id="registerForm">
                <div class="form-group">
                    <input type="text" id="registerUsername" class="form-input" placeholder="USERNAME (3-20 characters)" required minlength="3" maxlength="20">
                </div>
                <div class="form-group">
                    <input type="email" id="registerEmail" class="form-input" placeholder="EMAIL" required>
                    <div id="emailValidation" class="email-validation-message" style="display: none; margin-top: 5px; font-size: 12px;"></div>
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" class="form-input" placeholder="PASSWORD (min 6 characters)" required minlength="6">
                </div>
                <button type="submit" class="pixel-btn" style="width: 100%;">REGISTER</button>
            </form>
        </div>
    </div>

    <!-- Language Switcher -->
    <div class="lang-switch" onclick="toggleLanguage()">
        <span id="lang-switch">‰∏≠Êñá</span>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://shh-elf.onrender.com';  // Production URL

        console.log('API Base URL:', API_BASE_URL);
        console.log('Frontend loaded - Y2K PIXEL MODE ACTIVATED');

        // User management
        let currentUser = null;
        let authToken = null;

        // Check for saved authentication
        function checkAuth() {
            const savedToken = localStorage.getItem('authToken');
            const savedUser = localStorage.getItem('currentUser');

            if (savedToken && savedUser) {
                authToken = savedToken;
                currentUser = JSON.parse(savedUser);
                updateUserDisplay();
            }
        }

        // Update user display
        function updateUserDisplay() {
            const loggedOutControls = document.getElementById('loggedOutControls');
            const loggedInControls = document.getElementById('loggedInControls');
            const usernameDisplay = document.getElementById('usernameDisplay');

            if (currentUser) {
                loggedOutControls.style.display = 'none';
                loggedInControls.style.display = 'flex';
                usernameDisplay.textContent = `USER: ${currentUser.username.toUpperCase()}`;
            } else {
                loggedOutControls.style.display = 'flex';
                loggedInControls.style.display = 'none';
            }
        }

        // Modal management
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // API helper function
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            };

            if (authToken && authToken.trim() !== '') {
                defaultOptions.headers['Authorization'] = `Bearer ${authToken}`;
            }

            const finalOptions = { ...defaultOptions, ...options };
            if (options.headers) {
                finalOptions.headers = { ...defaultOptions.headers, ...options.headers };
            }

            const response = await fetch(url, finalOptions);

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
            }

            return response.json();
        }

        // Login function
        async function login(username, password) {
            try {
                const response = await apiRequest('/api/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                authToken = response.access_token;
                currentUser = response.user;

                localStorage.setItem('authToken', authToken);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                updateUserDisplay();
                hideModal('loginModal');
                showSuccess('Login successful!');

                return true;
            } catch (error) {
                showError(`Login failed: ${error.message}`);
                return false;
            }
        }

        // Register function
        async function checkEmailAvailability(email) {
            try {
                const response = await apiRequest(`/api/check-email?email=${encodeURIComponent(email)}`);
                return response;
            } catch (error) {
                console.error('Error checking email:', error);
                return null;
            }
        }

        async function register(username, email, password) {
            // Validate username first
            if (username.length < 3 || username.length > 20) {
                showError('Áî®Êà∑ÂêçÈïøÂ∫¶ÂøÖÈ°ªÂú®3-20‰∏™Â≠óÁ¨¶‰πãÈó¥');
                return false;
            }

            if (password.length < 6) {
                showError('ÂØÜÁ†ÅÈïøÂ∫¶Ëá≥Â∞ë‰∏∫6‰∏™Â≠óÁ¨¶');
                return false;
            }

            // Check email availability
            const emailCheck = await checkEmailAvailability(email);
            if (emailCheck && !emailCheck.available) {
                showError(emailCheck.message);
                return false;
            }

            try {
                const response = await apiRequest('/api/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, email, password })
                });

                if (response.email_sent) {
                    // ÈÇÆ‰ª∂È™åËØÅÊµÅÁ®ã
                    hideModal('registerModal');
                    showEmailVerificationMessage(response.message);
                } else {
                    // Áõ¥Êé•Ê≥®ÂÜåÊàêÂäüÔºàÈÇÆ‰ª∂ÊúçÂä°Êú™ÈÖçÁΩÆÔºâ
                    authToken = response.access_token;
                    currentUser = response.user;

                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));

                    updateUserDisplay();
                    hideModal('registerModal');
                    showSuccess(response.message || 'Registration successful!');
                }

                return true;
            } catch (error) {
                showError(`Registration failed: ${error.message}`);
                return false;
            }
        }

        // ÊòæÁ§∫ÈÇÆÁÆ±È™åËØÅÊ∂àÊÅØ
        function showEmailVerificationMessage(message) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.display = 'block';
            overlay.innerHTML = `
                <div class="modal">
                    <div class="modal-header">EMAIL VERIFICATION</div>
                    <div style="margin-bottom: 20px; color: var(--white); line-height: 1.6;">
                        <p>${message}</p>
                        <p style="margin-top: 15px; color: var(--light-gray); font-size: 0.9rem;">
                            Didn't receive the email? Please check your spam folder
                        </p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="pixel-btn" style="width: 100%;">
                        OK
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);

            // 5ÁßíÂêéËá™Âä®ÂÖ≥Èó≠
            setTimeout(() => {
                if (overlay.parentElement) {
                    overlay.remove();
                }
            }, 8000);
        }

        // Logout function
        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            updateUserDisplay();
            hideHistory();
            showSuccess('Logged out successfully!');
        }

        // Show/hide history
        function showHistory() {
            if (!currentUser) {
                showError('Please login to view your history');
                return;
            }

            const historyContainer = document.getElementById('history');
            historyContainer.style.display = 'block';
            loadUserHistory();
            historyContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function hideHistory() {
            document.getElementById('history').style.display = 'none';
        }

        // Load user history
        async function loadUserHistory() {
            const historyContent = document.getElementById('historyContent');
            historyContent.innerHTML = '<div class="loading-text">Loading your recommendations...</div>';

            try {
                const recommendations = await apiRequest('/api/my-recommendations');

                if (recommendations.length === 0) {
                    historyContent.innerHTML = '<div style="text-align: center; color: var(--light-gray); padding: 40px;">No recommendations yet. Create your first one below!</div>';
                    return;
                }

                historyContent.innerHTML = recommendations.map(rec => `
                    <div class="history-item">
                        <div class="history-item-header">
                            <div class="history-book-title">${rec.book_title}</div>
                            <div class="history-date">${new Date(rec.created_at).toLocaleDateString()}</div>
                        </div>
                        <div class="history-details">
                            <strong>For:</strong> ${rec.recipient_name} (${rec.relationship}) |
                            <strong>Language:</strong> ${rec.language}
                        </div>
                        <div class="history-audio">
                            <audio controls class="audio-player" style="width: 100%;">
                                <source src="${API_BASE_URL}/${rec.audio_path}" type="audio/mpeg">
                                Your browser does not support audio playback.
                            </audio>
                        </div>
                        <div style="margin-top: 10px;">
                            <button onclick="copyToClipboard('${API_BASE_URL}/share/${rec.share_id}')" class="pixel-btn" style="font-size: 0.9rem;">
                                Copy Share Link
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                historyContent.innerHTML = `<div style="text-align: center; color: #ff0000; padding: 40px;">Failed to load history: ${error.message}</div>`;
            }
        }

        // Success message function
        function showSuccess(message) {
            console.log('Success:', message);
            // You could add a success notification here
        }

        // Matrix Rain Effect
        function initMatrix() {
            const canvas = document.getElementById('matrix');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const chars = '01010101SHHELFBOOK';
            const charSize = 14;
            const columns = canvas.width / charSize;
            const drops = [];
            
            for (let i = 0; i < columns; i++) {
                drops[i] = 1;
            }
            
            function draw() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#003300';
                ctx.font = charSize + 'px monospace';
                
                for (let i = 0; i < drops.length; i++) {
                    const text = chars[Math.floor(Math.random() * chars.length)];
                    ctx.fillText(text, i * charSize, drops[i] * charSize);
                    
                    if (drops[i] * charSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    
                    drops[i]++;
                }
            }
            
            setInterval(draw, 50);
        }
        
        // Initialize matrix effect
        initMatrix();
        
        // Window resize handler
        window.addEventListener('resize', () => {
            initMatrix();
        });

        // Language translations
        const translations = {
            en: {
                'label-book': "BOOK TITLE",
                'label-recipient': "RECOMMEND TO",
                'label-relationship': "RELATIONSHIP",
                'label-interests': "THEIR INTERESTS (OPTIONAL)",
                'label-language': "LANGUAGE",
                'label-tone': "RECOMMENDATION TONE",
                'submit-btn': "GENERATE AUDIO RECOMMENDATION",
                'loading-text1': "GENERATING PERSONALIZED BOOK TALK...",
                'loading-text2': "PROCESSING NEURAL NETWORKS... 10-15 SECONDS",
                'success-title': "BOOK TALK GENERATED SUCCESSFULLY!",
                'share-title': "SHARE YOUR RECOMMENDATION",
                'copy-btn': "COPY LINK",
                'lang-switch': "‰∏≠Êñá",
                placeholders: {
                    book: "e.g., The Seven Husbands of Evelyn Hugo",
                    recipient: "e.g., Sarah, my book-loving friend",
                    interests: "e.g., loves romance novels, enjoys character-driven stories..."
                },
                relationships: ["FRIEND", "CLASSMATE", "COLLEAGUE", "FAMILY", "STUDENT"],
                relationshipValues: ["friend", "classmate", "colleague", "family", "student"],
                tones: ["FRIENDLY & ENTHUSIASTIC", "PROFESSIONAL & OBJECTIVE", "CASUAL & HUMOROUS", "WARM & CARING"],
                toneValues: ["friendly and enthusiastic", "professional and objective", "casual and humorous", "warm and caring"]
            },
            zh: {
                'label-book': "‰π¶Á±çÂêçÁß∞",
                'label-recipient': "Êé®ËçêÁªôË∞Å",
                'label-relationship': "‰Ω†‰ª¨ÁöÑÂÖ≥Á≥ª",
                'label-interests': "TAÁöÑÂÖ¥Ë∂£Áà±Â•ΩÔºàÂèØÈÄâÔºâ",
                'label-language': "ËØ≠Ë®Ä",
                'label-tone': "Êé®ËçêËØ≠Ë∞É",
                'label-dialect': "ËØ≠Èü≥ÊñπË®Ä",
                'submit-btn': "ÁîüÊàêËØ≠Èü≥Êé®Ëçê",
                'loading-text1': "Ê≠£Âú®ÁîüÊàê‰∏™ÊÄßÂåñ‰π¶Á±çÊé®Ëçê...",
                'loading-text2': "Á•ûÁªèÁΩëÁªúÂ§ÑÁêÜ‰∏≠... 10-15Áßí",
                'success-title': "‰π¶Á±çÊé®ËçêÁîüÊàêÊàêÂäüÔºÅ",
                'share-title': "ÂàÜ‰∫´‰Ω†ÁöÑÊé®Ëçê",
                'copy-btn': "Â§çÂà∂ÈìæÊé•",
                'lang-switch': "ENGLISH",
                placeholders: {
                    book: "‰æãÂ¶ÇÔºö„ÄäÊ¥ªÁùÄ„Äã",
                    recipient: "‰æãÂ¶ÇÔºöÊàëÁöÑÊúãÂèãÂ∞èÊòé",
                    interests: "‰æãÂ¶ÇÔºöÂñúÊ¨¢ÊñáÂ≠¶Â∞èËØ¥ÔºåÁà±ÁúãÂéÜÂè≤ÊïÖ‰∫ã..."
                },
                relationships: ["ÊúãÂèã", "ÂêåÂ≠¶", "Âêå‰∫ã", "ÂÆ∂‰∫∫", "Â≠¶Áîü"],
                relationshipValues: ["ÊúãÂèã", "ÂêåÂ≠¶", "Âêå‰∫ã", "ÂÆ∂‰∫∫", "Â≠¶Áîü"],
                tones: ["ÂèãÂ•ΩÁÉ≠ÊÉÖ", "‰∏ì‰∏öÂÆ¢ËßÇ", "ËΩªÊùæÂπΩÈªò", "Ê∏©Êöñ‰∫≤Âàá"],
                toneValues: ["ÂèãÂ•ΩÁÉ≠ÊÉÖ", "‰∏ì‰∏öÂÆ¢ËßÇ", "ËΩªÊùæÂπΩÈªò", "Ê∏©Êöñ‰∫≤Âàá"]
            }
        };

        let currentLang = 'en';

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            updateLanguage();
        }

        function updateLanguage() {
            const t = translations[currentLang];
            
            // Update labels and text
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element && typeof t[key] === 'string') {
                    element.textContent = t[key];
                }
            });
            
            // Update placeholders
            if (t.placeholders) {
                document.getElementById('book_title').placeholder = t.placeholders.book;
                document.getElementById('recipient_name').placeholder = t.placeholders.recipient;
                document.getElementById('recipient_interests').placeholder = t.placeholders.interests;
            }
            
            // Update dropdown options
            if (t.relationships) {
                const relationshipSelect = document.getElementById('relationship');
                relationshipSelect.innerHTML = '';
                t.relationships.forEach((rel, i) => {
                    const option = document.createElement('option');
                    option.value = t.relationshipValues[i];
                    option.textContent = rel;
                    relationshipSelect.appendChild(option);
                });
            }
            
            if (t.tones) {
                const toneSelect = document.getElementById('tone');
                toneSelect.innerHTML = '';
                t.tones.forEach((tone, i) => {
                    const option = document.createElement('option');
                    option.value = t.toneValues[i];
                    option.textContent = tone;
                    toneSelect.appendChild(option);
                });
            }

            // Control dialect selection visibility based on language select value
            const dialectGroup = document.getElementById('dialect-group');
            const languageSelect = document.getElementById('language');
            if (languageSelect.value === '‰∏≠Êñá') {
                dialectGroup.style.display = 'block';
            } else {
                dialectGroup.style.display = 'none';
            }
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Form event listeners
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            await login(username, password);
        });

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');

            // ÂÆ¢Êà∑Á´ØÈ™åËØÅ
            if (username.length < 3 || username.length > 20) {
                showError('Username must be between 3-20 characters');
                return;
            }

            if (password.length < 6) {
                showError('Password must be at least 6 characters');
                return;
            }

            // ÁÆÄÂçïÁöÑÈÇÆÁÆ±Ê†ºÂºèÈ™åËØÅ
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showError('Please enter a valid email address');
                return;
            }

            // Disable button and show loading state
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'REGISTERING...';
            submitBtn.style.opacity = '0.6';
            submitBtn.style.cursor = 'not-allowed';

            try {
                await register(username, email, password);
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            }
        });

        // Real-time email validation
        let emailValidationTimeout;
        document.getElementById('registerEmail').addEventListener('input', function(e) {
            const email = e.target.value;
            const validationDiv = document.getElementById('emailValidation');

            // Clear previous timeout
            if (emailValidationTimeout) {
                clearTimeout(emailValidationTimeout);
            }

            // Hide validation if email is empty
            if (!email.trim()) {
                validationDiv.style.display = 'none';
                return;
            }

            // Basic email format validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                validationDiv.style.display = 'block';
                validationDiv.className = 'email-validation-message error';
                validationDiv.textContent = 'Invalid email format';
                return;
            }

            // Show checking message
            validationDiv.style.display = 'block';
            validationDiv.className = 'email-validation-message checking';
            validationDiv.textContent = 'Checking availability...';

            // Debounced API call
            emailValidationTimeout = setTimeout(async () => {
                const result = await checkEmailAvailability(email);
                if (result) {
                    if (result.available) {
                        validationDiv.className = 'email-validation-message success';
                        validationDiv.textContent = '‚úì Email available';
                    } else {
                        validationDiv.className = 'email-validation-message error';
                        validationDiv.textContent = '‚úó ' + result.message;
                    }
                } else {
                    validationDiv.style.display = 'none';
                }
            }, 500); // 500ms delay to avoid too many API calls
        });

        // Modified recommendation form submission to include auth headers
        document.getElementById('recommendationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const loadingDiv = document.getElementById('loading');
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('errorMessage');
            
            // Hide previous results/errors
            loadingDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            submitBtn.disabled = true;
            
            // Collect form data
            const formData = {
                book_title: document.getElementById('book_title').value,
                recipient_name: document.getElementById('recipient_name').value,
                relationship: document.getElementById('relationship').value,
                recipient_interests: document.getElementById('recipient_interests').value,
                tone: document.getElementById('tone').value,
                language: document.getElementById('language').value,
                dialect: document.getElementById('dialect').value
            };
            
            try {
                console.log('Sending request to:', `${API_BASE_URL}/api/generate-recommendation`);
                console.log('Form data:', formData);

                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                };

                // Add auth header if user is logged in and has valid token
                if (authToken && authToken.trim() !== '') {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const response = await fetch(`${API_BASE_URL}/api/generate-recommendation`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(formData)
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('Response data:', result);

                if (result.success) {
                    // Show result
                    loadingDiv.style.display = 'none';
                    resultDiv.style.display = 'block';

                    // Set audio player
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = `${API_BASE_URL}/${result.audio_path}`;

                    // Set share URL - use backend sharing for reliable access
                    const shareUrl = `${API_BASE_URL}/share/${result.share_id}`;
                    document.getElementById('shareUrl').value = shareUrl;
                    
                    // Scroll to result
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    throw new Error('SYSTEM ERROR: GENERATION FAILED');
                }
            } catch (error) {
                console.error('Error:', error);
                loadingDiv.style.display = 'none';
                showError(`SYSTEM ERROR: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
            }
        });
        
        function copyToClipboard(customUrl = null) {
            let urlToCopy;
            if (customUrl) {
                urlToCopy = customUrl;
            } else {
                const shareUrlInput = document.getElementById('shareUrl');
                urlToCopy = shareUrlInput.value;
            }

            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(urlToCopy).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }

            function fallbackCopy() {
                if (!customUrl) {
                    const shareUrlInput = document.getElementById('shareUrl');
                    shareUrlInput.select();
                    shareUrlInput.setSelectionRange(0, 99999); // For mobile
                }
                try {
                    // Create temporary input for custom URLs
                    if (customUrl) {
                        const tempInput = document.createElement('input');
                        tempInput.value = urlToCopy;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempInput);
                    } else {
                        document.execCommand('copy');
                    }
                    showCopySuccess();
                } catch (err) {
                    console.error('Copy failed:', err);
                }
            }

            function showCopySuccess() {
                const copyBtn = document.getElementById('copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = currentLang === 'en' ? '‚úì COPIED!' : '‚úì Â∑≤Â§çÂà∂!';

                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Add language selector event listener
        document.addEventListener('DOMContentLoaded', function() {
            const languageSelect = document.getElementById('language');
            languageSelect.addEventListener('change', function() {
                const dialectGroup = document.getElementById('dialect-group');
                if (this.value === '‰∏≠Êñá') {
                    dialectGroup.style.display = 'block';
                } else {
                    dialectGroup.style.display = 'none';
                }
            });
        });

        // Book Gallery Functions
        let allBooks = [];
        let currentFilter = 'all';

        async function loadBookGallery() {
            try {
                const response = await apiRequest('/api/book-gallery');
                allBooks = response.books;
                displayBooks(allBooks);
            } catch (error) {
                console.error('Failed to load book gallery:', error);
                document.getElementById('booksGrid').innerHTML =
                    '<div style="text-align: center; color: #ff0000; padding: 40px;">Failed to load book gallery</div>';
            }
        }

        function displayBooks(books) {
            const grid = document.getElementById('booksGrid');
            if (books.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: var(--light-gray); padding: 40px;">No books found</div>';
                return;
            }

            grid.innerHTML = books.map(book => `
                <div class="book-card" data-cefr="${book.cefr_level}">
                    <div class="book-header">
                        <div class="book-cover">
                            <img src="${book.cover_url}" alt="${book.title}"
                                 onerror="this.style.display='none'; this.parentElement.innerHTML='üìö';">
                        </div>
                        <div class="book-info">
                            <div class="book-title">${book.title}</div>
                            <div class="book-author">by ${book.author}</div>
                            <div class="book-meta">
                                <span class="meta-tag difficulty-tag">${book.cefr_level}</span>
                                <span class="meta-tag vocab-tag">${book.estimated_vocabulary} words</span>
                                <span class="meta-tag">${book.genre}</span>
                            </div>
                        </div>
                    </div>

                    <div class="sample-section">
                        <div class="sample-title">üìñ Sample Paragraph</div>
                        <div class="sample-text">"${book.sample_paragraph}"</div>
                        <div class="audio-controls">
                            <button class="audio-btn" onclick="playAudio('${book.sample_audio_path}', this)">
                                üéß Listen Sample
                            </button>
                            <button class="audio-btn" onclick="playAudio('${book.book_talk_audio_path}', this)">
                                üéôÔ∏è Book Talk
                            </button>
                        </div>
                    </div>

                    <div class="formal-models">
                        <div style="color: var(--primary-green); font-size: 12px; margin-bottom: 5px;">FORMAL MODELS:</div>
                        ${book.formal_models.map(model => `<span class="formal-model-tag">${model}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function filterBooks(filter) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            currentFilter = filter;
            let filteredBooks = allBooks;

            if (filter === 'B1') {
                filteredBooks = allBooks.filter(book => book.cefr_level === 'B1');
            } else if (filter === 'B2') {
                filteredBooks = allBooks.filter(book => book.cefr_level === 'B2');
            } else if (filter === 'formal-models') {
                // Show books with interesting formal models
                filteredBooks = allBooks.filter(book =>
                    book.formal_models.some(model =>
                        model.includes('thinking') || model.includes('illusion') || model.includes('form-giving')
                    )
                );
            }

            displayBooks(filteredBooks);
        }

        let currentAudio = null;
        let currentButton = null;

        function playAudio(audioPath, buttonElement) {
            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                if (currentButton) {
                    currentButton.textContent = currentButton.textContent.replace('‚è∏Ô∏è', 'üéß').replace('‚èπÔ∏è', 'üéôÔ∏è');
                    currentButton.disabled = false;
                }
            }

            // Play new audio
            currentAudio = new Audio(`${API_BASE_URL}/${audioPath}`);
            currentButton = buttonElement;

            buttonElement.textContent = buttonElement.textContent.includes('Sample') ? '‚è∏Ô∏è Playing...' : '‚èπÔ∏è Playing...';
            buttonElement.disabled = true;

            currentAudio.play().catch(error => {
                console.error('Audio playback failed:', error);
                buttonElement.textContent = '‚ùå Audio Error';
                setTimeout(() => {
                    buttonElement.textContent = buttonElement.textContent.includes('Sample') ? 'üéß Listen Sample' : 'üéôÔ∏è Book Talk';
                    buttonElement.disabled = false;
                }, 2000);
            });

            currentAudio.onended = () => {
                buttonElement.textContent = buttonElement.textContent.includes('Sample') ? 'üéß Listen Sample' : 'üéôÔ∏è Book Talk';
                buttonElement.disabled = false;
                currentAudio = null;
                currentButton = null;
            };
        }

        // Initialize
        window.onload = function() {
            updateLanguage();
            checkAuth(); // Check for saved authentication
            loadBookGallery(); // Load book gallery
            console.log('Y2K PIXEL MODE ACTIVATED');
            console.log('API Base URL:', API_BASE_URL);

            // Test API connection
            fetch(`${API_BASE_URL}/api/health`)
                .then(response => response.json())
                .then(data => console.log('Backend status:', data))
                .catch(error => console.error('Backend connection failed:', error));
        };

        // Modal click outside to close
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>
